<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZASTopo Pro - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
        /* Ù†ÙØ³ ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªÙ…Ø§Ù…Ø§Ù‹ */
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f4; overflow: hidden; }
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        /* ... (Ø§Ø­ØªÙØ¸ Ø¨Ø¬Ù…ÙŠØ¹ ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ù† V14 Ù‡Ù†Ø§) ... */
        /* Ø³Ø£Ø®ØªØµØ± CSS Ù‡Ù†Ø§ Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø­Ø©ØŒ Ù„ÙƒÙ† ÙÙŠ Ù…Ù„ÙÙƒ Ø¶Ø¹ CSS Ø§Ù„Ù†Ø³Ø®Ø© V14 ÙƒØ§Ù…Ù„Ø§Ù‹ */
        #sidebar { position: absolute; top: 10px; right: 10px; width: 370px; background: rgba(255, 255, 255, 0.98); padding: 15px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); z-index: 2000; max-height: 90vh; overflow-y: auto; border-right: 5px solid #2ecc71; transition: transform 0.3s ease-in-out; }
        @media (max-width: 768px) { #sidebar { position: fixed; top: 0; right: 0; bottom: 0; width: 85%; border-radius: 0; transform: translateX(100%); } #sidebar.active { transform: translateX(0); } }
        /* ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª ... */

        /* ========================================= */
        /* ğŸ” ØªØµÙ…ÙŠÙ… Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø¬Ø¯ÙŠØ¯) */
        /* ========================================= */
        #auth-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #2c3e50, #000000);
            z-index: 9999; /* ÙÙˆÙ‚ ÙƒÙ„ Ø´ÙŠØ¡ */
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; color: white;
        }
        .auth-box {
            background: white; color: #333; padding: 30px; border-radius: 10px;
            width: 350px; max-width: 90%; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .auth-box h2 { color: #2ecc71; margin-bottom: 20px; }
        .auth-input {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;
        }
        .auth-btn {
            width: 100%; padding: 12px; border: none; border-radius: 5px;
            background: #2ecc71; color: white; font-weight: bold; cursor: pointer;
            font-size: 16px; margin-bottom: 10px;
        }
        .auth-btn:hover { background: #27ae60; }
        .switch-btn { background: none; color: #3498db; text-decoration: underline; cursor: pointer; border: none; }
        #auth-error { color: red; font-size: 12px; margin-bottom: 10px; display: none; }
        
        /* Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        #logout-btn {
            background: #c0392b; color: white; margin-top: 20px; width: 100%;
        }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div class="auth-box">
            <h1 style="color:#2ecc71; margin:0;">ZASTopo Pro ğŸ‡²ğŸ‡¦</h1>
            <p style="color:#777; margin-bottom:20px;">Ù…Ù†ØµØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙˆØºØ±Ø§ÙÙŠ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</p>
            
            <h2 id="auth-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <p id="auth-error"></p>
            
            <input type="email" id="email" class="auth-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="password" class="auth-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            
            <button class="auth-btn" onclick="handleAuth()" id="submit-btn">Ø¯Ø®ÙˆÙ„</button>
            
            <p>
                <button class="switch-btn" onclick="toggleAuthMode()" id="toggle-msg">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
            </p>
        </div>
    </div>

    <div id="sidebar">
        <h1>ZASTopo Pro</h1>
        <button id="logout-btn" onclick="logoutUser()">
            <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </button>
    </div>

    <div id="map"></div>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ============================================
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø£Ø¯Ù†Ø§Ù‡ Ø¨Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ)
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyDxxxxxxxxxxxxxxxxxxxxxxxxxxxx", // ğŸ”´ Ø¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ Ù‡Ù†Ø§
            authDomain: "zastopo-xxxxx.firebaseapp.com", // ğŸ”´ Ø¶Ø¹ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ù‡Ù†Ø§
            projectId: "zastopo-xxxxx",
            storageBucket: "zastopo-xxxxx.appspot.com",
            messagingSenderId: "xxxxxxxxxxxx",
            appId: "1:xxxxxxxxxxxx:web:xxxxxxxxxxxx"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // ============================================
        // 2. Ù…Ù†Ø·Ù‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        // ============================================
        let isLoginMode = true;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ù‡
                document.getElementById('auth-overlay').style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„
                console.log("Welcome " + user.email);
            } else {
                // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„
                document.getElementById('auth-overlay').style.display = 'flex'; // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„
            }
        });

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            if (isLoginMode) {
                document.getElementById('auth-title').innerText = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
                document.getElementById('submit-btn').innerText = "Ø¯Ø®ÙˆÙ„";
                document.getElementById('toggle-msg').innerText = "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯";
            } else {
                document.getElementById('auth-title').innerText = "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯";
                document.getElementById('submit-btn').innerText = "ØªØ³Ø¬ÙŠÙ„";
                document.getElementById('toggle-msg').innerText = "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
            }
            document.getElementById('auth-error').style.display = 'none';
        }

        function handleAuth() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            const errorMsg = document.getElementById('auth-error');

            if(pass.length < 6) {
                errorMsg.innerText = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„";
                errorMsg.style.display = 'block';
                return;
            }

            if (isLoginMode) {
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                auth.signInWithEmailAndPassword(email, pass)
                    .catch((error) => {
                        errorMsg.innerText = "Ø®Ø·Ø£: Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
                        errorMsg.style.display = 'block';
                    });
            } else {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
                auth.createUserWithEmailAndPassword(email, pass)
                    .then((userCredential) => {
                        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ.");
                        // Ø³ÙŠØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    })
                    .catch((error) => {
                        errorMsg.innerText = "Ø®Ø·Ø£: " + error.message;
                        errorMsg.style.display = 'block';
                    });
            }
        }

        function logoutUser() {
            auth.signOut().then(() => {
                alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
                location.reload(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ¸Ù‡Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„
            });
        }

        // ============================================
        // 3. ÙƒÙˆØ¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ¨Ø§Ù‚ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (V14)
        // ============================================
        // ... (Ø¶Ø¹ Ù‡Ù†Ø§ ÙƒÙ„ ÙƒÙˆØ¯ JavaScript Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ Leaflet Ùˆ ZASTopo) ...
        // ...
    </script>
</body>
</html>
